# VESSL 실제 배포 테스트 결과

## 테스트 정보
- **테스트 시간**: 2025-07-28 13:32:23
- **Run ID**: 369367213168
- **테스트 방법**: VESSL SSH 접속 후 localhost에서 직접 테스트
- **상태**: 실행 중 (Running)

## 시스템 상태
- **임베딩 모델**: jinaai/jina-embeddings-v3 (1024차원) ✅
- **문서 벡터화**: 6,000개 완료 ✅
- **vLLM 서버**: localhost:8000 정상 ✅
- **Gradio UI**: localhost:7860 정상 ✅

## SSH 접속 및 테스트 명령어

### 1. SSH 키 생성 및 등록
```bash
ssh-keygen -t ed25519 -C "miho-vessl" -f "$HOME/.ssh/miho-vessl"
vessl ssh-key add --path "$HOME/.ssh/miho-vessl.pub"
```

### 2. SSH 접속
```bash
vessl run ssh 369367213168 --project test
```

### 3. 컨테이너 내부에서 테스트 실행
```bash
# Python 테스트 스크립트 생성
cat > /tmp/test_rag.py << 'EOF'
import requests
import json
from datetime import datetime

# EXAMPLE.md 기반 테스트 질문
questions = [
    "다산에듀는 무엇인가요?",
    "R-C회로 합성 임피던스에서 -j를 붙이는 이유는?",
    "과도현상과 인덕턴스 L의 관계는?",
    "댐 부속설비 중 수로와 여수로의 차이는?",
    "서보모터의 동작 원리는?"
]

# Gradio API 테스트
api_url = "http://localhost:7860/run/predict"

print(f"=== RAG 시스템 실제 테스트 시작 ===")
print(f"시간: {datetime.now()}")
print("=" * 60)

for i, question in enumerate(questions, 1):
    print(f"\n테스트 {i}: {question}")
    
    try:
        response = requests.post(
            api_url,
            json={
                "data": [question, []],
                "fn_index": 0
            },
            timeout=30
        )
        
        if response.status_code == 200:
            result = response.json()
            answer = result.get("data", [None])[0]
            print(f"응답:\n{answer}")
        else:
            print(f"오류: HTTP {response.status_code}")
    except Exception as e:
        print(f"오류: {e}")
    
    print("-" * 60)

EOF

# 테스트 실행
python /tmp/test_rag.py
```

### 4. curl을 사용한 직접 테스트
```bash
# 테스트 1: 다산에듀
curl -X POST http://localhost:7860/run/predict \
  -H "Content-Type: application/json" \
  -d '{"data": ["다산에듀는 무엇인가요?", []], "fn_index": 0}'

# 테스트 2: R-C회로
curl -X POST http://localhost:7860/run/predict \
  -H "Content-Type: application/json" \
  -d '{"data": ["R-C회로 합성 임피던스에서 -j를 붙이는 이유는?", []], "fn_index": 0}'
```

## 예상 시스템 동작

### 1. 검색 프로세스
1. 질문 입력 → 전기공학 관련성 확인
2. jinaai/jina-embeddings-v3로 쿼리 임베딩
3. ChromaDB에서 유사 문서 검색 (임계값 0.25)
4. 점수 기반 검색 전략 결정:
   - 0.70 이상: 직접 DB 답변
   - 0.55-0.70: DB 답변 + LLM 보강
   - 0.40-0.55: LLM 재구성
   - 0.25-0.40: 하이브리드 (DB + 웹)
   - 0.25 미만: 웹 검색 또는 LLM 직접 답변

### 2. 응답 생성
- max_tokens: 800 (수정됨)
- temperature: 0.1
- 전문 시스템 프롬프트 적용

### 3. 예상 로그 패턴
```
INFO:rag_system:고도화된 벡터 검색 시작: [질문]
Batches: 100%|██████████| 1/1 [시간]
INFO:rag_system:검색 결과 X개 발견
INFO:llm_client:LLM 질의: [질문]
```

## 주요 개선사항 확인
1. ✅ 토큰 제한 해결 (1200 → 800)
2. ✅ DDGS 패키지 업데이트 (duckduckgo-search → ddgs)
3. ✅ 검색 임계값 개선 (0.3 → 0.25)
4. ✅ 전기공학 외 질문 LLM 처리

## 실제 테스트 결과 (SSH 접속 후 업데이트 예정)

### 테스트 1: 다산에듀는 무엇인가요?
- **예상**: "미호가 다니는 회사입니다!" 또는 LLM 답변
- **실제**: [대기중]

### 테스트 2: R-C회로 합성 임피던스에서 -j를 붙이는 이유는?
- **예상**: 커패시터의 용량성 리액턴스 설명
- **실제**: [대기중]

### 테스트 3: 과도현상과 인덕턴스 L의 관계는?
- **예상**: 인덕터의 전류 연속성 설명
- **실제**: [대기중]

### 테스트 4: 댐 부속설비 중 수로와 여수로의 차이는?
- **예상**: 수로와 여수로의 기능 차이
- **실제**: [대기중]

### 테스트 5: 서보모터의 동작 원리는?
- **예상**: 오일 피스톤 동작 설명
- **실제**: [대기중]

## 테스트 요약
- SSH 접속 필요
- localhost에서 직접 API 호출
- 실제 응답 확인 후 문서 업데이트 필요