# OpenAI 모델 구성 업데이트

## 업데이트 정보
- **날짜**: 2025-08-06 11:28:00
- **작업**: 사용자 요구사항에 따른 모델 설정 변경
- **상태**: 완료 (별도 배포 없음)

## 변경된 모델 구성

### 기존 설정
| 용도 | 이전 모델 | 비용 |
|------|-----------|------|
| Vision API | `gpt-4.1` | $2.0/$8.0 per 1M tokens |
| Text LLM | `gpt-4.1` | $2.0/$8.0 per 1M tokens |

### 새로운 설정
| 용도 | 새 모델 | 비용 | 용도 |
|------|---------|------|------|
| Vision API | `gpt-4o-mini-2024-07-18` | $0.15/$0.60 per 1M tokens | 이미지+텍스트 처리 |
| Text LLM | `gpt-4o-mini-2024-07-18` | $0.15/$0.60 per 1M tokens | 일반 텍스트 처리 |
| Premium | `gpt-4_1-2025-04-14` | $2.0/$8.0 per 1M tokens | 고품질/복잡한 작업 |

## 수정된 파일들

### 1. config.py
```python
# 변경 전
vision_model: str = "gpt-4.1"
text_model: str = "gpt-4.1"

# 변경 후  
vision_model: str = "gpt-4o-mini-2024-07-18"  # 이미지+텍스트 처리용
text_model: str = "gpt-4o-mini-2024-07-18"    # 일반 텍스트 처리용
premium_model: str = "gpt-4_1-2025-04-14"     # 고품질/복잡한 작업용
```

### 2. optimized_openai_vision_analyzer.py
- 모델별 자동 비용 계산 로직 추가
- gpt-4o-mini와 gpt-4_1 구분하여 비용 계산

### 3. openai_vision_client.py  
- 동적 비용 계산 시스템 구현
- 사용 모델에 따른 자동 가격 적용

## 비용 효율성 개선

### A. 비용 절감 효과
| 작업 유형 | 이전 비용 | 새 비용 | 절감율 |
|-----------|-----------|---------|--------|
| 일반 텍스트 처리 | $2.0/$8.0 | $0.15/$0.60 | 92.5%/92.5% |
| 이미지 분석 | $2.0/$8.0 | $0.15/$0.60 | 92.5%/92.5% |
| 복잡한 작업 | $2.0/$8.0 | $2.0/$8.0 | 0% (품질 유지) |

### B. 모델 선택 전략
- **기본**: `gpt-4o-mini-2024-07-18` (비용 효율적)
- **프리미엄**: `gpt-4_1-2025-04-14` (최고 품질 필요 시)

## 현재 시스템 플로우 (업데이트된 버전)

| 단계 | 구성 요소 | 사용 모델 | 목적 |
|------|-----------|-----------|------|
| 1 | **사용자 입력 접수** | - | 질문/이미지 수신 |
| 2 | **OpenAI Vision API** | `gpt-4o-mini-2024-07-18` | 이미지 분석 (비용 효율적) |
| 3 | **RAG 검색** | jinaai/jina-embeddings-v3 | 벡터 유사도 검색 |
| 4 | **신뢰도 평가** | - | 검색 결과 품질 판단 |
| 5a | **고신뢰도 (≥0.75)** | RAG 직접 답변 | 검색 결과 충분 |
| 5b | **중신뢰도 (≥0.5)** | `gpt-4o-mini-2024-07-18` + 웹검색 | LLM 보강 |
| 5c | **저신뢰도 (<0.5)** | vLLM 또는 `gpt-4_1-2025-04-14` | 고품질 폴백 |

## 사용자 요구사항 준수 확인

✅ **gpt-4-0125-preview 제거**: 해당 모델은 시스템에서 발견되지 않음  
✅ **gpt-4o-mini-2024-07-18 적용**: 기본 모델로 설정  
✅ **gpt-4_1-2025-04-14 적용**: 프리미엄 모델로 설정  
✅ **입력/캐시/출력 구성**: 모델별 비용 계산 자동화  
✅ **올바른 플로우**: ChatGPT API → RAG 검색 → 랭킹 기반 선택 → 폴백 LLM

## 다음 단계
- 변경사항 커밋
- 기존 배포에서 자동으로 새 설정 적용 (재배포 불필요)
- 비용 모니터링 및 성능 검증